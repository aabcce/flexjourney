<?xml version="1.0" encoding="utf-8"?>
<mx:DividedBox direction="horizontal" xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark" xmlns:mx="library://ns.adobe.com/flex/halo" 
		 width="100%" height="100%" xmlns:valueObjects="valueObjects.*" xmlns:jyarticleagent="services.jyarticleagent.*">
	<fx:Script>
		<![CDATA[
			import mx.events.FlexEvent;
			import mx.collections.ArrayCollection;
			import mx.rpc.events.ResultEvent;
			import mx.controls.Alert;
			import journey.model.ModelLocator;
			[Bindable]
			private var model:ModelLocator = ModelLocator.getInstance();
			
			protected function button_clickHandler(event:MouseEvent):void
			{
				addArticleResult.token = jyArticleAgent.addArticle(jyArticle);
			}

			protected function addArticleResult_resultHandler(event:ResultEvent):void
			{
				if(event.result)
				{
					titleTextInput.text = '';
					commentTextInput.text = '';
					contentTextInput.text = '';
					getArticleListResult.token = jyArticleAgent.getArticleList(model.currParty.partyid.toString());
				}
			}

			protected function dataGrid_creationCompleteHandler(event:FlexEvent):void
			{
				getArticleListResult.token = jyArticleAgent.getArticleList(model.currParty.partyid.toString());
			}

		]]>
	</fx:Script>
	<fx:Declarations>
		<valueObjects:JyArticle id="jyArticle" partyid="{model.currParty.partyid}">
			
		</valueObjects:JyArticle>
		<jyarticleagent:JyArticleAgent id="jyArticleAgent" fault="Alert.show(event.fault.faultString)"/>
		<s:CallResponder id="addArticleResult" result="addArticleResult_resultHandler(event)"/>
		<s:CallResponder id="getArticleListResult"/>
		<valueObjects:JyArticle id="jyArticle2" articleid="{parseInt(articleidTextInput.text)}" userid="{parseInt(useridTextInput.text)}" partyid="{parseInt(partyidTextInput.text)}"/>

	</fx:Declarations>
	<fx:Binding source="dataGrid.selectedItem as JyArticle" destination="jyArticle2"/>
	<mx:DataGrid dataProvider="{getArticleListResult.lastResult}" editable="false" width="60%" id="dataGrid" 
				 creationComplete="dataGrid_creationCompleteHandler(event)">
		<mx:columns>
			<mx:DataGridColumn headerText="title" dataField="title"/>
			<mx:DataGridColumn headerText="comment" dataField="comment"/>
			<mx:DataGridColumn headerText="useremail" dataField="useremail"/>
			<mx:DataGridColumn headerText="adddate" dataField="adddate"/>
		</mx:columns>
	</mx:DataGrid>
	<mx:Form id="articleform" defaultButton="{button}" width="40%">
		<mx:FormItem label="Title">
			<s:TextInput id="titleTextInput" text="@{jyArticle.title}"/>
		</mx:FormItem>
		<mx:FormItem label="Comment">
			<s:TextInput id="commentTextInput" text="@{jyArticle.comment}"/>
		</mx:FormItem>
		<mx:FormItem label="Content">
			<s:TextArea id="contentTextInput" text="@{jyArticle.content}"/>
		</mx:FormItem>
		<s:Button label="写好了" id="button" click="button_clickHandler(event)"/>
	</mx:Form>
	<mx:Form>
		<mx:FormItem label="Describe">
			<s:TextInput id="describeTextInput" text="@{jyArticle2.describe}"/>
		</mx:FormItem>
		<mx:FormItem label="Content">
			<s:TextInput id="contentTextInput2" text="@{jyArticle2.content}"/>
		</mx:FormItem>
		<mx:FormItem label="Title">
			<s:TextInput id="titleTextInput2" text="@{jyArticle2.title}"/>
		</mx:FormItem>
		<mx:FormItem label="Articleid">
			<s:TextInput id="articleidTextInput" text="{jyArticle2.articleid}"/>
		</mx:FormItem>
		<mx:FormItem label="Useremail">
			<s:TextInput id="useremailTextInput" text="@{jyArticle2.useremail}"/>
		</mx:FormItem>
		<mx:FormItem label="Adddate">
			<mx:Text id="adddateText" text="{jyArticle2.adddate}"/>
		</mx:FormItem>
		<mx:FormItem label="Userid">
			<s:TextInput id="useridTextInput" text="{jyArticle2.userid}"/>
		</mx:FormItem>
		<mx:FormItem label="Comment">
			<s:TextInput id="commentTextInput2" text="@{jyArticle2.comment}"/>
		</mx:FormItem>
		<mx:FormItem label="Serial">
			<s:TextInput id="serialTextInput" text="@{jyArticle2.serial}"/>
		</mx:FormItem>
		<mx:FormItem label="Partyid">
			<s:TextInput id="partyidTextInput" text="{jyArticle2.partyid}"/>
		</mx:FormItem>
	</mx:Form>
	
</mx:DividedBox>
