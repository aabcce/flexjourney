<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark" xmlns:mx="library://ns.adobe.com/flex/halo" 
		 width="100%" height="100%" xmlns:valueObjects="valueObjects.*" xmlns:jyattendagent="services.jyattendagent.*">
	<s:layout>
		<s:VerticalLayout>
			
		</s:VerticalLayout>
	</s:layout>
	<fx:Script>
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.rpc.events.ResultEvent;
			import mx.controls.Alert;
			
			import journey.model.ModelLocator;
			[Bindable]
			private var model:ModelLocator = ModelLocator.getInstance();
			[Bindable]
			private var attendList:ArrayCollection;

			protected function button_clickHandler(event:MouseEvent):void
			{
				addAttendResult.token = jyAttendAgent.addAttend(jyAttend);
			}
			
			protected function addAttendResult_resultHandler(event:ResultEvent):void
			{
				// TODO Auto-generated method stub
				if(event.result)
				{
					Alert.show("报名成功，请静候佳音！");
				}
				else
				{
					Alert.show("已经报了名了哟！");
				}
			}

			protected function button2_clickHandler(event:MouseEvent):void
			{
				getAttendListResult.token = jyAttendAgent.getAttendListByID(model.currParty.partyid);
			}


			protected function getAttendListResult_resultHandler(event:ResultEvent):void
			{
				// TODO Auto-generated method stub
				attendList = event.result;
			}

		]]>
	</fx:Script>
	<fx:Declarations>
		<valueObjects:JyAttend id="jyAttend" partyid="{model.currParty.partyid}"/>		
		<jyattendagent:JyAttendAgent id="jyAttendAgent" fault="Alert.show(event.fault.faultString)"/>		
		<s:CallResponder id="addAttendResult" result="addAttendResult_resultHandler(event)"/>
		<s:CallResponder id="getAttendListResult" result="getAttendListResult_resultHandler(event)"/>		
	</fx:Declarations>
	<mx:Form>
		<mx:FormItem label="Title">
			<s:TextInput id="titleTextInput" text="@{jyAttend.title}"/>
		</mx:FormItem>
		<mx:FormItem label="Content">
			<s:TextArea id="contentTextInput" text="@{jyAttend.content}">
				
			</s:TextArea>
		</mx:FormItem>
		<mx:FormItem>
			<s:Button label="写好了！" id="button" click="button_clickHandler(event)"/>
		</mx:FormItem>
	</mx:Form>

	<mx:Repeater id="tileList1" dataProvider="{attendList}" width="100%">
		<mx:itemRenderer>
			<fx:Component>
				<mx:Form>
					<mx:FormItem label="Title">
						<mx:Text id="titleText" text="{data.title}"/>
					</mx:FormItem>
					<mx:FormItem label="Useremail">
						<mx:Text id="useremailText" text="{data.useremail}"/>
					</mx:FormItem>
					<mx:FormItem label="Adddate">
						<mx:DateField enabled="false" id="adddateDateField" selectedDate="{data.adddate}"/>
					</mx:FormItem>
					<mx:FormItem label="Content">
						<s:TextArea id="contentText" text="{data.content}">
							
						</s:TextArea>
					</mx:FormItem>
				</mx:Form>
			</fx:Component>
		</mx:itemRenderer>
	</mx:Repeater>	
</s:Group>
